package it.wibs.eplastic.controller;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import it.wibs.eplastic.bindcommerceIntegration.api.obj.documents.Documents;
import it.wibs.eplastic.bindcommerceIntegration.api.obj.documents.DocumentsResponse;
import it.wibs.eplastic.entities.MessageEntity;
import it.wibs.eplastic.services.OrderServices;

@RestController
@RequestMapping("/eplastic" )
public class OrderController {
	
	private static final Logger LOGGER = LoggerFactory.getLogger(OrderController.class);
	
	@Autowired
	OrderServices orderService;
	
	@PostMapping("/getlocalorderslist")
	public ResponseEntity getOrdersListFromLocal() throws Exception{
		DocumentsResponse resp = null;
		try {
			resp = orderService.getOrderFromFileXml();
			if(resp != null) {
				
				return  new ResponseEntity(new MessageEntity( resp.getDocuments().getDocumentList().size()+ " Orders founded!! ") , HttpStatus.CREATED);
			}else {
				return  new ResponseEntity(new MessageEntity("error getting orderList!!"), HttpStatus.BAD_REQUEST);
			}
			
		}catch(Exception e) {
			e.getMessage();
			LOGGER.error("error getting orders from orderService.getOrderFromFileXml()");
		}
		return new ResponseEntity(new MessageEntity("error getting orders"),HttpStatus.BAD_REQUEST);
	}
	
	@PostMapping("/getorderslist")
	public ResponseEntity getOrdersListFromUrl() throws Exception{
		Documents orders = new Documents();
		DocumentsResponse resp = null;
		String error = null;
		try {
			resp = orderService.callOrderList();
			
			if(resp != null) {
				
				return  new ResponseEntity(new MessageEntity( orders.getDocumentList().size()+ " Orders founded!! ") , HttpStatus.CREATED);
			}else {
				return  new ResponseEntity(new MessageEntity("error getting orderList!!"), HttpStatus.BAD_REQUEST );
			}
			
		}catch(Exception e) {
			error = e.getMessage();
			LOGGER.error("error getting orders from orderService.callOrderList():", e , e.getMessage());
		}
		return new ResponseEntity(new MessageEntity("error getting orders" + error),HttpStatus.BAD_REQUEST);
	}
	
	
}
